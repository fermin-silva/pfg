<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>PFG Algoritmos Geneticos</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="stylesheet" href="./assets/css/bootstrap.css" media="screen">
    <link rel="stylesheet" href="./assets/css/bootswatch.min.css">
    <link rel="shortcut icon" href="http://portal.uned.es/favicon.png" />
    <!-- <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"> -->
    <link rel="stylesheet" href="./bower_components/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="./assets/css/ekko-lightbox.min.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="../bower_components/html5shiv/dist/html5shiv.js"></script>
      <script src="../bower_components/respond/dest/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
  	<!-- top nav bar -->
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a href="index.html" class="navbar-brand">PFG<small>AE</small></a>
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main" style="border-color:#ECF0F1">
            <i class="fa fa-bars" style="color:white"></i>
          </button>
        </div>
        <div class="navbar-collapse collapse" id="navbar-main">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="themes">
              	<i class="fa fa-book"></i>&nbsp; Documentos <span class="caret"></span>
              </a>
              <ul class="dropdown-menu" aria-labelledby="themes">
                <li><a href="anteproyecto.html">Anteproyecto</a></li>
                <li><a href="memoria.html">Memoria</a></li>
              </ul>
            </li>
            <li>
              <a href="instrucciones.html"><i class="fa fa-info-circle"></i>&nbsp; Instrucciones</a>
            </li>
            <li>
              <a href="ejecutar.html"><i class="fa fa-cogs"></i>&nbsp; Ejecutar</a>
            </li>
            <li>
              <a href="benchmarks.html"><i class="fa fa-bar-chart"></i>&nbsp; Pruebas Empíricas</a>
            </li>
          </ul>

          <ul class="nav navbar-nav navbar-right">
            <li><a href="http://portal.uned.es/" target="_blank" class="no-padding"><img style="max-height:60px" src="http://portal.uned.es/NUEVOWEB/IMAGENES/logo_uned.gif"></a></li>
          </ul>
        </div>
      </div>
    </div>
	<!-- END top nav bar -->

	<div class="container">

    <div class="page-header">
      <div class="row">
        <div class="col-lg-10 col-md-7 col-sm-6">
          <h1>Ejecución</h1>
        </div>
      </div>
    </div>



    <div class="row"> <!-- Inicio del form input -->
      <div class="col-md-8">
        <div class="well" style="padding-right: 50px;">
          <form class="form-horizontal" id="theForm">
            <fieldset>
              <legend>Elección de Parámetros</legend>

              <div class="form-group"> <!-- Tamaño poblacion -->
                <label for="poblacion" class="col-xs-6 control-label">Tamaño de la Población</label>

                <div class="input-group">
                  <input type="text" class="form-control" value="500" name="tamaño.poblacion" id="poblacion">
                  <span class="input-group-btn">
                    <a href="#" class="btn btn-info" title="" data-toggle="popover"
                       data-trigger="focus" data-placement="right"
                       data-content="Número entero con el tamaño de la población">
                      <i class="fa fa-question-circle"></i>
                    </a>
                  </span>
                </div>

              </div>  <!-- fin generaciones -->

              <div class="form-group"> <!-- Generaciones -->
                <label for="generaciones" class="col-xs-6 control-label">Generaciones</label>

                <div class="input-group">
                  <input type="text" class="form-control" value="60" id="generaciones" name="generaciones">
                  <span class="input-group-btn">
                    <a href="#" class="btn btn-info" title="" data-toggle="popover"
                       data-trigger="focus" data-placement="right"
                       data-content="Número entero con la cantidad de iteraciones a ejecutar">
                      <i class="fa fa-question-circle"></i>
                    </a>
                  </span>
                </div>

              </div>  <!-- fin generaciones -->

              <div class="form-group"> <!-- select Funcion -->
                <label for="selectFuncion" class="col-xs-6 control-label">Función</label>

                <div class="input-group">
                  <select class="form-control" id="selectFuncion" name="funcion">
                    <optgroup label="Multidimensionales">
                      <option selected="selected">Rastrigin</option>
                      <option>Griewank</option>
                      <option>Ackley</option>
                      <option>Schwefel</option>
                    </optgroup>
                    <optgroup label="Dos Dimensiones">
                      <option>Schaffer2</option>
                      <option>Schubert</option>
                    </optgroup>
                  </select>
                  <span class="input-group-btn">
                    <a href="#" class="btn btn-info" title="" data-toggle="popover"
                       data-trigger="focus" data-placement="right"
                       data-content="Nombre de la función a minimizar">
                      <i class="fa fa-question-circle"></i>
                    </a>
                  </span>
                </div>

              </div>  <!-- Fin seleccion de funcion -->

              <div class="form-group"> <!-- dimension -->
                <label for="dimension" class="col-xs-6 control-label">Dimensión</label>

                <div class="input-group">
                  <input type="text" class="form-control" value="10" id="dimension" name="dimension.funcion">
                  <span class="input-group-btn">
                    <a href="#" class="btn btn-info" title="" data-toggle="popover"
                       data-trigger="focus" data-placement="right"
                       data-content="Dimensionalidad de la función (si es aplicable y no fija)">
                      <i class="fa fa-question-circle"></i>
                    </a>
                  </span>
                </div>

              </div>  <!-- fin dimension -->


              <legend>Elección de Operadores</legend>

              <div class="form-group"> <!-- select recombinacion -->
                <label for="selectRecombinacion" class="col-xs-6 control-label">Recombinación</label>

                <div class="input-group">
                  <select class="form-control" id="selectRecombinacion" name="recombinacion">
                    <optgroup label="Discretas">
                      <option selected="selected">DiscretaBGA</option>
                      <option>UnPunto</option>
                    </optgroup>
                    <optgroup label="Aritméticas">
                      <option>AlphaBeta</option>
                      <option>K</option>
                      <option>AritmeticaCompleta</option>
                      <option>Simple</option>
                      <option>Unica</option>
                    </optgroup>
                    <optgroup label="Otras">
                      <option>NoOp</option>
                    </optgroup>
                  </select>
                  <span class="input-group-btn">
                    <a href="#" class="btn btn-info" title="" data-toggle="popover"
                       data-trigger="focus" data-placement="right"
                       data-content="Nombre de la Recombinación">
                      <i class="fa fa-question-circle"></i>
                    </a>
                  </span>
                </div>

              </div>  <!-- Fin seleccion de recombinacion -->

              <div class="form-group"> <!-- select seleccion -->
                <label for="selectSeleccion" class="col-xs-6 control-label">Selección de Padres</label>

                <div class="input-group">
                  <select class="form-control" id="selectSeleccion" name="seleccion">
                    <option>NoOp</option>
                    <option selected="selected">Torneo</option>
                  </select>
                  <span class="input-group-btn">
                    <a href="#" class="btn btn-info" title="" data-toggle="popover"
                       data-trigger="focus" data-placement="right"
                       data-content="Nombre de la Selección">
                      <i class="fa fa-question-circle"></i>
                    </a>
                  </span>
                </div>

              </div>  <!-- Fin seleccion de seleccion -->

              <div class="form-group"> <!-- select mutacion -->
                <label for="selectMutacion" class="col-xs-6 control-label">Mutación</label>

                <div class="input-group">
                  <select class="form-control" id="selectMutacion" name="mutacion">
                    <option>NoOp</option>
                    <option selected="selected">Normal</option>
                    <option>Uniforme</option>
                  </select>
                  <span class="input-group-btn">
                    <a href="#" class="btn btn-info" title="" data-toggle="popover"
                       data-trigger="focus" data-placement="right"
                       data-content="Nombre de la Mutación">
                      <i class="fa fa-question-circle"></i>
                    </a>
                  </span>
                </div>

              </div>  <!-- Fin seleccion de mutacion -->

              <legend>Otros Parámetros</legend>

              <div class="form-group"> <!-- desviacion -->
                <label for="desviacion" class="col-xs-6 control-label">Desviación</label>

                <div class="input-group">
                  <input type="text" class="form-control" value="0.5" id="desviacion" name="desviacion.mutacion">
                  <span class="input-group-btn">
                    <a href="#" class="btn btn-info" title="" data-toggle="popover"
                       data-trigger="focus" data-placement="right"
                       data-content="Número real mayor que cero">
                      <i class="fa fa-question-circle"></i>
                    </a>
                  </span>
                </div>

                <span class="help-block col-sm-6 col-sm-offset-6">Aplicable solamente a la Mutación Normal</span>

              </div>  <!-- fin desviacion -->

              <div class="form-group"> <!-- prob mutacion -->
                <label for="probMutacion" class="col-xs-6 control-label">Probabilidad de Mutación</label>

                <div class="input-group" >
                  <input type="text" class="form-control" value="0.05" id="probMutacion" name="probabilidad.mutacion">
                  <span class="input-group-btn">
                    <a href="#" class="btn btn-info" title="" data-toggle="popover"
                       data-trigger="focus" data-placement="right" data-html="true"
                       data-content="Probabilidad de mutación <b>para cada gen</b>. Debe valer entre [0, 1]">
                      <i class="fa fa-question-circle"></i>
                    </a>
                  </span>
                </div>

              </div>  <!-- fin prob mutacion -->

              <div class="form-group"> <!-- select tamaño K -->
                <label for="selectTamanioK" class="col-xs-6 control-label">Tamaño de K</label>

                <div class="input-group">
                  <select class="form-control" id="selectTamanioK" name="puntos.combinacion">
                    <option selected="selected">2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                  </select>
                  <span class="input-group-btn">
                    <a href="#" class="btn btn-info" title="" data-toggle="popover"
                       data-trigger="focus" data-placement="right"
                       data-content="Cantidad de ejes a recombinar. Debe ser menor o igual que la dimensión de la población">
                      <i class="fa fa-question-circle"></i>
                    </a>
                  </span>
                </div>

                <span class="help-block col-sm-6 col-sm-offset-6">Aplicable solamente a la Recombinación K</span>

              </div>  <!-- Fin tamaño de K -->

              <div class="form-group"> <!-- select tamaño torneo -->
                <label for="selectTamanioTorneo" class="col-xs-6 control-label">Tamaño del Torneo</label>

                <div class="input-group">
                  <input type="text" class="form-control" value="2" id="desviacion" name="tamaño.torneo">
                  <span class="input-group-btn">
                    <a href="#" class="btn btn-info" title="" data-toggle="popover"
                       data-trigger="focus" data-placement="right"
                       data-content="Número entero mayor que 1 y menor que el tamaño de la población">
                      <i class="fa fa-question-circle"></i>
                    </a>
                  </span>
                </div>
                <span class="help-block col-sm-6 col-sm-offset-6">Aplicable solamente a la Selección por Torneo</span>

              </div>  <!-- Fin tamaño del torneo -->

              <div class="form-group"> <!-- alpha Beta-->
                <label for="alpha" class="col-sm-3 col-xs-6 control-label">Alpha</label>

                <div class="input-group col-sm-3 col-xs-6" style="float: left;">
                  <input type="text" class="form-control" value="0.1" id="alpha" name="alpha">
                  <span class="input-group-btn">
                    <a href="#" class="btn btn-info" title="" data-toggle="popover"
                       data-trigger="focus" data-placement="right"
                       data-content="Valor de alpha (si aplica), entre [0, 1]">
                      <i class="fa fa-question-circle"></i>
                    </a>
                  </span>
                </div>

                <label for="beta" class="col-sm-3 col-xs-6 control-label">Beta</label>

                <div class="input-group col-sm-3 col-xs-6" style="float: left;">
                  <input type="text" class="form-control" value="0.3" id="beta" name="beta">
                  <span class="input-group-btn">
                    <a href="#" class="btn btn-info" title="" data-toggle="popover"
                       data-trigger="focus" data-placement="right"
                       data-content="Valor de beta (si aplica), entre [0, 1]">
                      <i class="fa fa-question-circle"></i>
                    </a>
                  </span>
                </div>
              </div>  <!-- fin alpha Beta -->

              <br><br>

              <div class="form-group">
                <div class="pull-right">
                  <button type="reset" class="btn btn-default" onClick="window.location.reload()">Cancelar</button>
                  <button id="ejecutar" type="submit" class="btn btn-primary">Ejecutar</button>
                </div>
              </div>

            </fieldset>
          </form>
        </div>
      </div>
    </div> <!-- FIN del form input -->

    <div id="anclaje"></div>

    <div class="row linkable"> <!-- Inicio del form input -->
      <div class="col-md-8">
        <div id="resultado">

        </div>
      </div>
    </div>

		<footer>
			<div class="panel panel-default">
			  <div class="panel-body">
			    <div class="row">
		          <div class="col-lg-12">
		            <p class="pull-right"><a href="#top">Ir hacia arriba</a></li>
		            <p>Realizado por el Alumno <a rel="nofollow">Fermin Silva</a>.</p>
		            <p>Dirigido por el Prof. <a href="http://www.ia.uned.es/~seve/" target="_blank" rel="nofollow">Severino Fernández Galán</a>.</p>
		            <p>Basado en <a href="http://getbootstrap.com" rel="nofollow">Bootstrap</a>. Iconos de <a href="http://fortawesome.github.io/Font-Awesome/" rel="nofollow">Font Awesome</a>. Web fonts de <a href="http://www.google.com/webfonts" rel="nofollow">Google</a>.</p>
		          </div>
		        </div>
			  </div>
			</div>
	  </footer>

	</div> <!-- END container -->

    <!-- <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script> -->
    <script src="./bower_components/jquery/jquery-1.10.2.min.js"></script>
    <script src="./bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="./assets/js/bootswatch.js"></script>
    <script src="./assets/js/ekko-lightbox.min.js"></script>
    <script src="./assets/js/lightbox_init.js"></script>

    <script src="./host.js"></script>
    <script type="text/javascript">
      $('#theForm').submit(function() {
           $theForm = $(this);

           $.ajax({
               type: $theForm.attr('method'),
               url: host + "/api/ag",
               data: $theForm.serialize(),
               success: function(data) {
                  var progreso = document.createElement("img");
                  progreso.setAttribute('src', host + "/" + data['img.progreso']);
                  progreso.setAttribute('width', '100%');

                  var aProgreso = document.createElement("a");
                  aProgreso.setAttribute("href", host + "/" + data['img.progreso']);
                  aProgreso.setAttribute("data-toggle", "lightbox");
                  aProgreso.appendChild(progreso);


                  var convergencia = document.createElement("img");
                  convergencia.setAttribute('src', host + "/" + data['img.momento']);
                  convergencia.setAttribute('width', '100%');

                  var aConvergencia = document.createElement("a");
                  aConvergencia.setAttribute("href", host + "/" + data['img.momento']);
                  aConvergencia.setAttribute("data-toggle", "lightbox");
                  aConvergencia.appendChild(convergencia);


                  var coords = new Array();
                  $.each(data.coords, function(i, coord) {
                      coords.push('<li class="col-lg-3 col-sm-4 col-xs-6">x<sub>' + (i + 1) + '</sub>: <b>' + coord.toFixed(3) + '</b></li>');
                  });

                  var centro = new Array();
                  $.each(data.centroide, function(i, centroide) {
                      centro.push('<li class="col-lg-3 col-sm-4 col-xs-6">x<sub>' + (i + 1) + '</sub>: <b>' + centroide.toFixed(3) + '</b></li>');
                  });

                  $('#resultado').html('');

                  $('#resultado')
                      .append('<h1 class="underline">Resultado de la Ejecución</h1>')
                      .append('<br><br>')
                      .append('<p>Tiempo de Ejecución: <b>' + data.tiempo + 'ms</b></p>')
                      .append('<p>Fitness del mejor Individuo obtenido: <b>' +
                              data.mejorFitness.toFixed(3) + '</b></p>')
                      .append('<p>Coordenadas del mínimo:</p>')
                      .append('<ul class="list-unstyled">' + coords.join('') + '</ul>')
                      .append('<div class="clearfix"><br></div>')
                      .append('<br>')
                      .append('<p>Coordenadas del centroide:</p>')
                      .append('<ul class="list-unstyled">' + centro.join('') + '</ul>')
                      .append('<div class="clearfix"><br></div>')
                      .append('<br>')
                      .append('<hr>')
                      .append('<p>La curva de progreso a continuación muestra la fitness del mejor individuo en las sucesivas iteraciones:</p>')
                      .append(aProgreso)
                      .append('<p>Valor mínimo encontrado: <b>' +
                              data.minimo.toFixed(3) + '</b> (mínimo global en <b>' +
                              data.minimoGlobal.toFixed(3)+ '</b>)</p>')
                      .append('<br><hr>')
                      .append('<p>La curva a continuación muestra la convergencia de la población, medida como la desviación típica de la población con respecto a su centroide:</p>')
                      .append(aConvergencia)
                      .append('<p>Desviación final de la población: <b>' +
                              data.desviacion.toFixed(3) + '</b></p>');

                  (function($) {
                      $(document).ready(function() {
                           $('html, body').animate({
                             'scrollTop':   $('#anclaje').offset().top
                           }, 800);
                      });
                  })(jQuery);

                  $("#ejecutar").attr("disabled", false).html("Ejecutar");
               }, // fin on success

              error: function(XMLHttpRequest, textStatus, errorThrown) {
                var html = '<div class="row">' +
                                '<div class="col-lg-12">' +
                                  '<div class="bs-component">' +
                                    '<div class="alert alert-dismissible alert-danger">' +
                                      '<button type="button" class="close" data-dismiss="alert">&times;</button>' +
                                      '<h4>[[ERROR]]</h4>' +
                                      '<p>[[MENSAJE]]</p>' +
                                    '</div>' +
                                  '</div>' +
                                '</div>' +
                              '</div>';

                var error = "";
                var mensaje = "";

                if (XMLHttpRequest.status == 0) {
                  error = "Error!";
                  mensaje = "No se pudo conectar con el servidor, revise " +
                            "su conexión y que la dirección del servidor " +
                            "funcione correctamente. <br>" +
                            "Si se está utilizando el servidor local, asegurese que " +
                            "este esté ejecutandose correctamente.";
                }
                else {
                  error = "Error HTTP " + XMLHttpRequest.status + " (" +
                                       textStatus + ")";
                  mensaje = XMLHttpRequest.statusText + "<br><pre>" +
                            XMLHttpRequest.responseText + "</pre>";
                }

                $('#resultado').html(html.replace("[[ERROR]]", error)
                                         .replace("[[MENSAJE]]", mensaje));

                $("#ejecutar").attr("disabled", false).html("Ejecutar");
              } //fin on error
            }); //fin de la llamada ajax

            $("#ejecutar").attr("disabled", true);
            $("#ejecutar").html('<i class="fa fa-refresh fa-spin"></i>');

            return false;
      });
    </script>

  </body>
</html>
